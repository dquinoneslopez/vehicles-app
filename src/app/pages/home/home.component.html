<div class="home-container">
  <mat-card class="main-card">
    <mat-card-header>
      <div class="header-content">
        <mat-card-title>Vehicle Makes</mat-card-title>
        <mat-card-subtitle>Browse available makes</mat-card-subtitle>
      </div>

      <!-- Search bar -->
      <div class="search-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search makes</mat-label>
          <input
            matInput
            placeholder="Type to search..."
            [value]="searchTerm"
            (input)="onSearchChange($event)"
            [disabled]="loading$ | async"
          />
          <mat-icon matSuffix>search</mat-icon>
          <button
            *ngIf="searchTerm"
            mat-icon-button
            matSuffix
            (click)="clearSearch()"
            aria-label="Clear search"
          >
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </mat-card-header>

    <mat-card-content class="card-content">
      <!-- Initial Loading spinner (only for first load) -->
      <div *ngIf="isInitialLoading$ | async" class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Loading makes...</p>
      </div>

      <!-- Results display -->
      <div
        *ngIf="((allMakes$ | async)?.length || 0) > 0"
        class="results-container"
      >
        <div class="results-info">
          <p>
            Showing {{ (filteredMakes$ | async)?.length || 0 }}
            <span *ngIf="searchTerm">
              of {{ (allMakes$ | async)?.length || 0 }} makes for "{{
                searchTerm
              }}"
            </span>
            <span *ngIf="!searchTerm">makes</span>
          </p>
        </div>

        <!-- Virtual scrolling for better performance -->
        <cdk-virtual-scroll-viewport itemSize="80" class="viewport">
          <div
            *cdkVirtualFor="
              let make of filteredMakes$ | async;
              let i = index;
              trackBy: trackByMake
            "
            class="make-item"
            (click)="onMakeClick(make)"
          >
            <mat-card class="make-card">
              <mat-card-content>
                <h4>{{ make.Make_Name }}</h4>
                <p>ID: {{ make.Make_ID }}</p>
              </mat-card-content>
            </mat-card>
          </div>
        </cdk-virtual-scroll-viewport>
      </div>

      <!-- No results state -->
      <div
        *ngIf="
          ((allMakes$ | async)?.length || 0) > 0 &&
          (filteredMakes$ | async)?.length === 0 &&
          searchTerm
        "
        class="no-results"
      >
        <mat-icon>search_off</mat-icon>
        <h3>No makes found</h3>
        <p>No makes match your search term "{{ searchTerm }}"</p>
        <p>Try searching for a different make name.</p>
        <button mat-raised-button color="primary" (click)="clearSearch()">
          Clear Search
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
